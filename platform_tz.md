# ТЕХНИЧЕСКОЕ ЗАДАНИЕ
## Платформа агрегации GPU-мощностей

---

## 1. ОБЩИЕ СВЕДЕНИЯ

### 1.1 Назначение
Платформа для агрегации GPU-мощностей от частных лиц и организаций с последующей перепродажей через marketplace (VAST.AI и аналоги).

### 1.2 Роли пользователей
- **Администратор** (владелец платформы)
- **Поставщик мощностей** (владелец оборудования)
- **Покупатель** (конечный пользователь, через внешние площадки)

---

## 2. ФУНКЦИОНАЛЬНЫЕ ТРЕБОВАНИЯ

### 2.1 Личный кабинет поставщика

#### Регистрация и авторизация (Email-based)

**Обязательная регистрация по email:**
- Email является основным идентификатором пользователя
- Пароль: минимум 8 символов, буквы + цифры
- Подтверждение email через ссылку/код
- Восстановление пароля через email

**Авторизация:**
- Вход по email + пароль
- Запомнить меня (опционально)
- Сессии с авто-выходом через 24ч

**Безопасность:**
- Двухфакторная аутентификация (2FA) — опционально
- История входов (IP, время, устройство)
- Блокировка после 5 неудачных попыток
- Верификация личности (KYC) — опционально

#### Управление оборудованием
- Добавление GPU/сервера:
  - Модель GPU (RTX 3090, A100, и т.д.)
  - Количество
  - Характеристики (VRAM, CUDA-ядер, память)
  - IP-адрес и порт для подключения
  - SSH/VNC доступ
  - Цена аренды за час
- Редактирование/удаление
- Статус: онлайн/офлайн/занято
- Статистика использования и дохода

#### Финансы
- Баланс личного кабинета
- История транзакций
- Вывод средств (карта, крипта)
- Начисления от аренды

---

### 2.2 Панель администратора

#### Мониторинг
- Список всех подключенных GPU
- Статус каждого устройства (online/offline/busy)
- Загрузка (CPU, GPU, RAM)
- Аптайм
- География размещения

#### Управление поставщиками
- Список пользователей
- Верификация
- Блокировка/разблокировка
- Комиссия для каждого поставщика (%)

#### Интеграции
- Подключение к VAST.AI API
- Подключение к другим marketplace (RunPod, Lambda, и т.д.)
- Автоматическая публикация GPU
- Синхронизация цен

#### Финансы
- Общий баланс платформы
- Комиссия платформы (X%)
- Выплаты поставщикам
- Отчеты по доходам

---

### 2.3 Интеграция с VAST.AI

#### Автоматизация
- Регистрация хостов через API
- Автоматическое выставление на продажу
- Управление ценами
- Мониторинг бронирований

#### API-методы
- Создание instance
- Обновление статуса
- Получение списка бронирований
- Автоматические выплаты

---

## 3. ТЕХНИЧЕСКАЯ АРХИТЕКТУРА

### 3.1 Компоненты системы
```
┌─────────────────┐
│   Web-интерфейс  │  ← React/Vue.js
│   (Dashboard)    │
└────────┬────────┘
         │
┌────────▼────────┐
│   API Gateway   │  ← FastAPI/Node.js
│   (REST/WebSocket)│
└────────┬────────┘
         │
┌────────▼────────┐
│  Core Service   │  ← Python/Go
│  - Auth         │
│  - Billing      │
│  - Monitoring   │
└────────┬────────┘
         │
┌────────▼────────┐
│  Database       │  ← PostgreSQL
│  - Users        │
│  - GPU          │
│  - Transactions │
└────────┬────────┘
         │
┌────────▼────────┐
│  Integrations   │
│  - VAST.AI API  │
│  - RunPod API   │
│  - Payment      │
└─────────────────┘
```

### 3.2 База данных

#### Таблицы:
- `users` — пользователи (email, password_hash, created_at, verified)
- `sessions` — сессии авторизации (token, user_id, expires_at, ip, user_agent)
- `login_attempts` — попытки входа (email, ip, success, timestamp)
- `gpu_servers` — серверы/оборудование
- `rentals` — аренды
- `transactions` — финансовые операции
- `integrations` — настройки интеграций
- `logs` — логи и мониторинг

### 3.2.1 Система аутентификации

**Email-аутентификация:**
- JWT токены для сессий (access + refresh)
- Хеширование паролей bcrypt/Argon2
- Подтверждение email через токен (24ч валидность)
- Восстановление пароля через secure token

**Защита:**
- Rate limiting: 5 попыток входа/минуту с одного IP
- Блокировка аккаунта после 5 неудачных попыток (15 мин)
- Сессии привязаны к IP + User-Agent
- Авто-выход через 24ч бездействия

### 3.3 Требования к серверу
- CPU: 4+ ядер
- RAM: 8+ GB
- SSD: 50+ GB
- ОС: Ubuntu 22.04 LTS

---

## 4. БЕЗОПАСНОСТЬ

### 4.1 Требования
- HTTPS/TLS 1.3
- Шифрование данных at rest
- Изоляция пользователей (Docker/KVM)
- DDoS-защита
- Backup ежедневно

### 4.2 Доступ к GPU
- VPN/Wireguard для подключения
- SSH-ключи
- Ограничение по IP
- Firewall

---

## 5. ЭТАПЫ РАЗРАБОТКИ

### MVP (2-3 недели)
- [ ] Регистрация/авторизация
- [ ] Добавление GPU
- [ ] Базовый дашборд админа
- [ ] Ручная интеграция с VAST.AI

### Phase 2 (3-4 недели)
- [ ] Автоматическая публикация
- [ ] Биллинг и выплаты
- [ ] Мониторинг в реальном времени
- [ ] Техподдержка (чат)

### Phase 3 (4+ недели)
- [ ] Мобильное приложение
- [ ] API для поставщиков
- [ ] Дополнительные marketplace
- [ ] ML-мониторинг

---

## 6. БИЗНЕС-МОДЕЛЬ

### Комиссия платформы
- **Фиксированная: 10%** с каждой аренды
- Без tier-ов и премиум-тарифов

### Ценообразование
- Поставщик сам устанавливает цену за час аренды
- Платформа автоматически добавляет 10% комиссии к цене покупателя
- Или: поставщик получает цену минус 10%

### Способы вывода средств
- **Криптовалюта:** USDT (TRC-20, ERC-20), BTC
- **Российский рубль:** банковская карта, СБП

---

## 7. УТОЧНЕННЫЕ ПАРАМЕТРЫ

✅ **Комиссия платформы:** 10% (фиксированная)
✅ **Способы вывода:** Криптовалюта (USDT, BTC) + Российский рубль (карты, СБП)
✅ **Фиксация цен:** Не требуется, поставщик устанавливает самостоятельно

## 8. ВОПРОСЫ ДЛЯ УТОЧНЕНИЯ

1. Какие именно marketplace планируется использовать? (VAST.AI, RunPod, Lambda, др.)
2. Какой минимальный объем GPU для старта?
3. Требуется ли верификация поставщиков (KYC)?
4. Нужен ли white-label для поставщиков?
5. Будет ли API для интеграции дата-центров?

---

**Дата:** 08.02.2026
**Автор:** Deya / OpenClaw
**Статус:** Черновик для обсуждения
